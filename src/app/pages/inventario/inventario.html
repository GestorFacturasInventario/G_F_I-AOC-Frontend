<div class="inventario-container">
    <h2>Gestión de Inventario</h2>
  
    <!-- Mensaje de notificación -->
    <div *ngIf="mensaje" class="mensaje" [ngClass]="{'mensaje-success': tipoMensaje === 'success', 'mensaje-error': tipoMensaje === 'error'}">
      {{ mensaje }}
    </div>
  
    <!-- Layout de 2 columnas -->
    <div class="content-wrapper">
      <!-- Formulario compacto a la izquierda -->
      <div class="formulario-card">
        <h3>{{ tituloFormulario }}</h3>
        
        <form (ngSubmit)="guardarArticulo()" class="formulario">
          <div class="form-group">
            <label for="num_parte">Número de Parte</label>
            <input 
              type="text" 
              id="num_parte"
              [(ngModel)]="num_parte" 
              name="num_parte"
              placeholder="Ej: ART-001"
              [disabled]="cargando || modoEdicion"
            />
            <small *ngIf="modoEdicion" class="help-text">El número de parte no se puede cambiar</small>
          </div>
  
          <div class="form-group">
            <label for="descripcion_art">Descripción</label>
            <textarea 
              id="descripcion_art" 
              [(ngModel)]="descripcion_art" 
              name="descripcion_art"
              placeholder="Descripción del artículo"
              [disabled]="cargando"
              rows="3"
            ></textarea>
          </div>
  
          <div class="form-group">
            <label for="cantidad">Cantidad en Stock</label>
            <input 
              type="number" 
              id="cantidad" 
              [(ngModel)]="cantidad" 
              name="cantidad"
              placeholder="0"
              min="0"
              [disabled]="cargando"
            />
          </div>
  
          <div class="form-group">
            <label for="imagen">Imagen</label>
            <input 
              type="file" 
              id="imagen_art" 
              (change)="onArchivoSeleccionado($event)"
              accept=".png,.jpg,.jpeg"
              [disabled]="cargando"
            />
            <small *ngIf="nombreArchivo" class="archivo-info">
              seleccionado: {{ nombreArchivo }}
            </small>
          </div>
  
          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="cargando"
            >
              {{ textoBoton }}
            </button>
            
            <button 
              type="button" 
              class="btn btn-secondary"
              (click)="cancelarEdicion()"
              [disabled]="cargando"
              *ngIf="modoEdicion"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
  
      <!-- Lista de artículos a la derecha -->
      <div class="articulos-lista">
        <h3>
          Productos en Inventario
          <span class="badge">{{ articulosFiltrados.length }}</span>
          <span *ngIf="articulosFiltrados.length !== articulos.length" class="filtrado-info">
            (filtrados de {{ articulos.length }})
          </span>
        </h3>
        
        <div *ngIf="cargando && articulos.length === 0" class="cargando">
          <div class="spinner"></div>
          Cargando inventario...
        </div>
  
        <div *ngIf="!cargando && articulos.length === 0" class="sin-datos">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
          </svg>
          <p>No hay artículos en inventario</p>
          <small>Agrega tu primer artículo</small>
        </div>
  
        <div *ngIf="!cargando && articulos.length > 0 && articulosFiltrados.length === 0" class="sin-datos">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <p>No se encontraron artículos</p>
          <small>Intenta con otro término de búsqueda</small>
        </div>
  
        <div class="articulos-grid" *ngIf="articulosFiltrados.length > 0">
          <div 
            *ngFor="let articulo of articulosFiltrados" 
            class="articulo-card"
            [ngClass]="{'articulo-seleccionado': articuloSeleccionado?._id === articulo._id}"
          >
            <div class="articulo-imagen-container">
              <img 
                [src]="articulo.imagen_art" 
                [alt]="articulo.descripcion_art"
                class="articulo-imagen"
                (error)="$event.target.src='https://via.placeholder.com/200x150?text=Sin+Imagen'"
              />
              <span 
                class="badge-stock"
                [ngClass]="{
                  'stock-bajo': articulo.cantidad < 10,
                  'stock-medio': articulo.cantidad >= 10 && articulo.cantidad < 50,
                  'stock-alto': articulo.cantidad >= 50
                }"
              >
                Stock: {{ articulo.cantidad }}
              </span>
            </div>
  
            <div class="articulo-info">
              <div class="articulo-numero">
                <strong>{{ articulo.num_parte }}</strong>
              </div>
              <div class="articulo-descripcion">
                {{ articulo.descripcion_art }}
              </div>
            </div>
  
            <div class="articulo-actions">
              <button
                class="btn btn-edit"
                (click)="seleccionarParaEditar(articulo)"
                [disabled]="cargando"
                title="Editar artículo"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                Editar
              </button>
  
              <button
                class="btn btn-danger"
                (click)="eliminarArticulo(articulo, $event)"
                [disabled]="cargando"
                title="Eliminar artículo"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>