<div class="usuarios-container">
  <h2>Gestión de Usuarios</h2>

  <!-- Mensaje de notificación -->
  <div *ngIf="mensaje" class="mensaje" [ngClass]="{'mensaje-success': tipoMensaje === 'success', 'mensaje-error': tipoMensaje === 'error'}">
    {{ mensaje }}
  </div>

  <!-- Formulario estático -->
  <div class="formulario-card">
    <h3>{{ usuarioSeleccionado ? 'Editar Usuario' : 'Nuevo Usuario' }}</h3>
    
    <form (ngSubmit)="guardarUsuario()" class="formulario">
      <div class="form-group">
        <label for="nombre">Nombre Completo</label>
        <input 
          type="text" 
          id="nombre" 
          [(ngModel)]="nombre" 
          name="nombre"
          placeholder="Ingresa nombre y apellido"
          [disabled]="cargando"
        />
      </div>

      <div class="form-group">
        <label for="correo">Correo Electrónico</label>
        <input 
          type="email" 
          id="correo" 
          [(ngModel)]="correo" 
          name="correo"
          placeholder="ejemplo@correo.com"
          [disabled]="cargando"
        />
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="cargando"
        >
          {{ textoBoton }}
        </button>
        
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="limpiarFormulario()"
          [disabled]="cargando"
          *ngIf="usuarioSeleccionado"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de usuarios -->
  <div class="usuarios-lista">
    <h3>
      Lista de Usuarios 
      <span class="badge">{{ usuariosFiltrados.length }}</span>
      <span *ngIf="usuariosFiltrados.length !== usuarios.length" class="filtrado-info">
        (filtrados de {{ usuarios.length }})
      </span>
    </h3>
    
    <div *ngIf="cargando && usuarios.length === 0" class="cargando">
      <div class="spinner"></div>
      Cargando usuarios...
    </div>

    <div *ngIf="!cargando && usuarios.length === 0" class="sin-datos">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <p>No hay usuarios registrados</p>
      <small>Agrega tu primer usuario usando el formulario de arriba</small>
    </div>

    <div *ngIf="!cargando && usuarios.length > 0 && usuariosFiltrados.length === 0" class="sin-datos">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <p>No se encontraron usuarios</p>
      <small>Intenta con otro término de búsqueda</small>
    </div>

    <div class="usuarios-grid" *ngIf="usuariosFiltrados.length > 0">
      <div 
        *ngFor="let usuario of usuariosFiltrados" 
        class="usuario-card"
        [ngClass]="{'usuario-seleccionado': usuarioSeleccionado?._id === usuario._id}"
        (click)="seleccionarUsuario(usuario)"
      >
        <div class="usuario-info">
          <div class="usuario-nombre">
            <strong>{{ usuario.nombre || 'Sin nombre' }}</strong>
          </div>
          <div class="usuario-correo">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            {{ usuario.correo }}
          </div>
          <div class="usuario-fecha" *ngIf="usuario.createdAt">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Registrado: {{ usuario.createdAt | date:'dd/MM/yyyy, h:mm a' }}
          </div>
        </div>
        
        <button 
          class="btn btn-danger"
          (click)="eliminarUsuario(usuario); $event.stopPropagation()"
          [disabled]="cargando"
          title="Eliminar usuario"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>